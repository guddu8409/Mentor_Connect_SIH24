<%- layout("/mentee/layouts/boilerplate") -%>

<div class="container mt-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-0">Mentors</h1>

        <!-- Real-time Search Bar -->
        <input type="text" id="searchBar" class="form-control" placeholder="Search by name, expertise, or skills"
            aria-label="Search">
    </div>

    <!-- Display message when no mentors found -->
    <div id="noMentorsMessage" class="alert alert-warning" role="alert" style="display: none;">
        No mentors found matching your criteria.
    </div>

    <div id="mentorList" class="row">
        <% mentors.forEach(mentor => { %>
        <div class="col-md-4 mb-4 mentor-card" data-username="<%= mentor.user.username.toLowerCase() %>"
            data-expertise="<%= mentor.expertise.join(' ').toLowerCase() %>"
            data-skills="<%= mentor.skills.join(' ').toLowerCase() %>">
            <div class="card">
                <img src="<%= mentor.coverPhoto || '/image/default-cover.jpg' %>" class="card-img-top"
                    alt="Cover Photo">
                <div class="card-body text-center">
                    <img src="<%= mentor.profilePicture || '/image/default-profile.png' %>"
                        class="profile-photo rounded-circle" alt="<%= mentor.user.username %>">
                    <h5 class="card-title mt-3"><%= mentor.user.username %></h5>
                    <p class="card-text">Expertise: <%= mentor.expertise.join(', ') %></p>
                    <p class="card-text">Experience: <%= mentor.yearsOfExperience %> years</p>
                    <a href="/mentee/mentors/<%= mentor._id %>" class="btn btn-sm btn-info">View Details</a>

                    <!-- Connection button logic -->
                    <% if (mentor.connectionStatus === "none") { %>
                    <form action="/mentee/connections/<%= mentor._id %>/connectRequest" method="POST"
                        class="d-inline-block">
                        <button type="submit" class="btn btn-sm btn-success">Add Connection</button>
                    </form>
                    <% } else if (mentor.connectionStatus === "pending") { %>
                    <!-- Cancel Pending Request Button -->
                    <form action="/mentee/connections/<%= mentor._id %>/cancelRequest?_method=delete" method="POST"
                        class="d-inline-block">
                        <button type="submit" class="btn btn-sm btn-danger">Cancel Request</button>
                    </form>
                    <% } else if (mentor.connectionStatus === "accepted") { %>
                    <button class="btn btn-sm btn-success" disabled>Connected</button>
                    <a href="/mentee/connections/<%= mentor._id %>/disconnect"
                        class="btn btn-sm btn-info">Disconnect</a>

                    <a href="/mentee/schedule/<%= mentor.user.id  %>" class="btn btn-sm btn-info">schedule</a>

                    <% } else { %>
                    <button class="btn btn-sm btn-danger" disabled>Rejected</button>
                    <% } %>

                </div>
            </div>
        </div>
        <% }) %>
    </div>
</div>

<script>
    // Function to handle real-time search
    document.getElementById('searchBar').addEventListener('input', function () {
        const query = this.value.toLowerCase();  // Get the search input value
        const mentorCards = document.querySelectorAll('.mentor-card');  // Get all mentor cards
        let found = false;  // Track if we find any mentor that matches the query

        mentorCards.forEach(card => {
            const username = card.getAttribute('data-username');
            const expertise = card.getAttribute('data-expertise');
            const skills = card.getAttribute('data-skills');

            // Check if the query matches any part of the mentor's name, expertise, or skills
            if (username.includes(query) || expertise.includes(query) || skills.includes(query)) {
                card.style.display = 'block';  // Show the mentor card
                found = true;
            } else {
                card.style.display = 'none';  // Hide the mentor card
            }
        });

        // If no mentors match the search, show the "No mentors found" message
        if (!found) {
            document.getElementById('noMentorsMessage').style.display = 'block';
        } else {
            document.getElementById('noMentorsMessage').style.display = 'none';
        }
    });
</script>